%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Second stage ini_file for BBS
%
% Sept, 2023 BB by June Skeeter
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Site_name = 'Burns BogSeedling'
SiteID = 'BBS'
input_path    = ''

%% Why is this necessary?
output_path   = 'C:/Database_local/yyyy/BB/clean/SecondStage/' 
high_level_path = {}
searchPath = 'auto'

% Contents:
% Misc. variables
% Profiles
% Radiation
% Soil
% Turbulent fluxes
% Carbon balance terms
% Energy storage terms

% ----------------------------------------------------------------------------
% Misc. important variables - temperature, pressure etc.
% ----------------------------------------------------------------------------

[Trace]
	variableName = 'TA_1_1_1'

	Evaluate = 'TA_1_1_1 = calc_avg_trace(clean_tv,TA_1_1_1,TA_ECCC,-1);'

	title = 'Air temperature at 4.5m (HMP)'
	units = '^oC'
	minMax = [-20,50]
[End]

[Trace]
	variableName = 'RH_1_1_1'

	Evaluate = 'RH_1_1_1 = calc_avg_trace(clean_tv,RH_1_1_1,RH_ECCC,-1);'

	title = 'RH at 4.5m (HMP)'
	units = '%'
	minMax = [0,110]
	clamped_minMax = [0,100] 
[End]


[Trace]
	variableName = 'P_1_1_1'

	Evaluate = 'P_1_1_1 = calc_avg_trace(clean_tv,[P_1_1_1,P_ECCC]);'

	title = 'precipitation (averaged between BB ECCC and BB1 stations)'
	units = 'mm' 
	minMax = [0,20]
[End]

[Trace]
	variableName = 'VPD_1_1_1'

	Evaluate = '[e_H,ea_H] = vappress(TA_1_1_1,RH_1_1_1);
				VPD_1_1_1 = ea_H - e_H;
				VPD_1_1_1 = VPD_1_1_1*10; % Converting kPa to hPa
				VPD_1_1_1 = max(VPD_1_1_1,0);'

	title = 'Vapour pressure deficit Vapour pressure deficit (from 2m HMP)'
	units = 'hPa'
	minMax = [0,100]
[End]


[Trace]
	variableName = 'SW_OUT_1_1_1'

	Evaluate = 'SW_OUT_1_1_1 = SW_OUT_1_1_1;'

	title = 'reflected shortwave radiation by CNR1'
	units = 'W/m^2'
	minMax = [0,1000]
[End]

[Trace]
	variableName = 'SW_IN_1_1_1'

	Evaluate = 'SW_IN_1_1_1 = calc_avg_trace(clean_tv,SW_IN_1_1_1,SW_IN_2_1_1,-1);'

	title = 'reflected shortwave radiation by CNR1'
	units = 'W/m^2'
	minMax = [0,1000]
[End]

[Trace]
	variableName = 'LW_IN_1_1_1'

	Evaluate = 'LW_IN_1_1_1 = calc_avg_trace(clean_tv,LW_IN_1_1_1,LW_IN_2_1_1,-1);'

	title = 'reflected shortwave radiation by CNR1'
	units = 'W/m^2'
	minMax = [0,1000]
[End]


[Trace]
	variableName = 'LW_OUT_1_1_1'

	Evaluate = 'LW_OUT_1_1_1 = SW_IN_1_1_1-SW_OUT_1_1_1+LW_IN_1_1_1-NETRAD_1_1_1;'

	title = 'reflected shortwave radiation by CNR1'
	units = 'W/m^2'
	minMax = [0,1000]
[End]


[Trace]
	variableName = 'NETRAD_1_1_1'

	Evaluate = 'NETRAD_1_1_1 = NETRAD_1_1_1;'

	title = 'net radiation by CNR1'
	units = 'W/m^2'
	minMax = [-100,1000]
[End]

[Trace]
	variableName = 'hpbl'

	Evaluate = 'hpbl = hpbl;'

	title = 'Estimated Height of Planetary Boundary Layer'
	units = 'm/s' 
	minMax = [0,3000]
[End]

[Trace]
	variableName = 'canopy_height_sample_mean'

	Evaluate = 'canopy_height_sample_mean = canopy_height_sample_mean*.01;'

	title = 'Estimated Canopy Hight'
	units = 'm' 
	minMax = [0,1000]
[End]

[Trace]
	variableName = 'canopy_height'

	Evaluate = '[data_out,tv_out] = DerivedVariablesForGapFilling(SiteID,2023,{"canopy_height_sample_mean"},0);
				[~,ix] = intersect(tv_out,clean_tv,"stable");
				canopy_height = data_out(ix);'

	title = 'Interpolated Canopy Height'
	units = 'm' 
	minMax = [0,10]
[End]

%%%% Data from CR10_Stations

[Trace]
	variableName = 'Bog_Height_at_Well_1'
	Evaluate = 'Bog_Height_at_Well_1 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_1");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_1'
	Evaluate = 'WTD_1 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_1");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_1_1_1'
	Evaluate = 'TS_1_1_1 = TS_1_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_1_2_1'
	Evaluate = 'TS_1_2_1 = TS_1_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_1_3_1'
	Evaluate = 'TS_1_3_1 = TS_1_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'Bog_Height_at_Well_2'
	Evaluate = 'Bog_Height_at_Well_2 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_2");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_2'
	Evaluate = 'WTD_2 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_2");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_2_1_1'
	Evaluate = 'TS_2_1_1 = TS_2_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_2_2_1'
	Evaluate = 'TS_2_2_1 = TS_2_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_2_3_1'
	Evaluate = 'TS_2_3_1 = TS_2_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'Bog_Height_at_Well_3'
	Evaluate = 'Bog_Height_at_Well_3 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_3");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_3'
	Evaluate = 'WTD_3 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_3");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_3_1_1'
	Evaluate = 'TS_3_1_1 = TS_3_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_3_2_1'
	Evaluate = 'TS_3_2_1 = TS_3_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_3_3_1'
	Evaluate = 'TS_3_3_1 = TS_3_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'Bog_Height_at_Well_4'
	Evaluate = 'Bog_Height_at_Well_4 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_4");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_4'
	Evaluate = 'WTD_4 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_4");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_4_1_1'
	Evaluate = 'TS_4_1_1 = TS_4_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_4_2_1'
	Evaluate = 'TS_4_2_1 = TS_4_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_4_3_1'
	Evaluate = 'TS_4_3_1 = TS_4_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'Bog_Height_at_Well_5'
	Evaluate = 'Bog_Height_at_Well_5 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_5");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_5'
	Evaluate = 'WTD_5 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_5");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_5_1_1'
	Evaluate = 'TS_5_1_1 = TS_5_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_5_2_1'
	Evaluate = 'TS_5_2_1 = TS_5_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_5_3_1'
	Evaluate = 'TS_5_3_1 = TS_5_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'Bog_Height_at_Well_6'
	Evaluate = 'Bog_Height_at_Well_6 = BB_WTH_Corrections(SiteID,clean_tv,"Bog_Height_at_Well_6");'
	title = '-'
	units = 'cm'
	minMax = [0,500]
[End]



[Trace]
	variableName = 'WTD_6'
	Evaluate = 'WTD_6 = BB_WTH_Corrections(SiteID,clean_tv,"WTD_6");'
	title = '-'
	units = 'cm'
	minMax = [-100,100]
[End]



[Trace]
	variableName = 'TS_6_1_1'
	Evaluate = 'TS_6_1_1 = TS_6_1_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_6_2_1'
	Evaluate = 'TS_6_2_1 = TS_6_2_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'TS_6_3_1'
	Evaluate = 'TS_6_3_1 = TS_6_3_1;'
	title = '-'
	units = 'C'
	minMax = [-5,35]
[End]



[Trace]
	variableName = 'VWC_1_1_1'
	Evaluate = 'VWC_1_1_1 = VWC_1_1_1;'
	title = '-'
	units = '%'
	minMax = [0,95]
[End]



[Trace]
	variableName = 'VWC_2_1_1'
	Evaluate = 'VWC_2_1_1 = VWC_2_1_1;'
	title = '-'
	units = '%'
	minMax = [0,95]
[End]



[Trace]
	variableName = 'WTH_1_1_1'
	Evaluate = 'WTH_1_1_1 = WTH_1_1_1;'
	title = '-'
	units = 'cm'
	minMax = [0,200]
[End]



[Trace]
	variableName = 'WTH_1'
	Evaluate = 'WTH_1 = BB_WTH_Corrections(SiteID,clean_tv,"WTH_1");'
	title = '-'
	units = 'cm'
	minMax = [0,1000]
[End]

